<% include header.ejs %>

       
      <h2>Welcome <%= profile.username %></h2>
      <% if (profile) { %>
        <% var user = profile %>      
      <% } %>
      <script src="../../js/aes.js"></script>
      <script src="../../js/main.js"></script>
      
      <button id="powerOff" onclick="logoutAll()"><i class="fas fa-power-off"></i></button>

      <!-- Modal -->
      <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">Check MasterPassword</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                
              <input type="password" name="masterPassword" id="master" >
              
            </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" id="Submit" data-dismiss="modal" class="btn btn-primary" onclick="CheckPassword()">Save changes</button>
            </div>
          </div>
        </div>
      </div>
    <button  data-toggle="modal" id="FbPass" data-target="#exampleModalCenter"></button>
      <!-- Settings Model -->
      <div class="modal fade" id="Settings" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">Set Passwords</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                
              <form action="" method="POST">
                 <div class="form-group">
                   <label for="Facebook">Facebook Password</label>
                   <input type="password" class="form-control" name="facebook" id="facebook" value="Facebbok Password">
                 </div>
                 <div class="form-group">
                    <label for="Facebook">Github Password</label>
                  <input type="password" class="form-control" name="github" id="github" value="Github Password">
                </div>
                <div class="form-group">
                    <label for="Facebook">twitter Password</label>
                  <input type="password" class="form-control" name="twitter" id="twitter" value="Twitter Password">
                </div>
                <div class="form-group">
                    <label for="Facebook">LinkedIn Password</label>
                  <input type="password" class="form-control" name="linkedIn" id="linkedIn" value="LinkedIn Password">
                </div>
                                  
              <input type="submit"   class="btn btn-primary" value="Submit">
              </form>

            </div>
            
          </div>
        </div>
      </div>


      <button data-toggle="modal" id="SavePass" data-target="#Settings"><i class="fas fa-tools"></i></button>

    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-6 col-sm-12">
                  <div class="card" style="width: 18rem;">
                        <img src="../../img/fb.png" class="card-img-top image" alt="...">
                    <div class="card-body">
                            <h5 class="card-title">Facebook</h5>
                            
                            <input class="inputmaster" type="text" name="" id="fbPass" value="***********" disabled><button class="seePass" onclick="seePasswordFb()"  ><i class="fas fa-eye"></i></button>
                            <!-- <button onclick="seePasswordFb()">See</button> -->
                            <button class="btn btn-success" onclick="fblogin()">Login</button>
                             <button class="btn btn-danger" onclick="fbLogoutUser()">Logout</button>               
                    </div>
                    </div>
            </div>
            <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="card" style="width: 18rem;">
                            <img src="../../img/twitter.png" class="card-img-top image" alt="...">
                        <div class="card-body">
                                <h5 class="card-title">Twitter</h5>
                               
                                
                                <input class="inputmaster" type="text" name="" id="TwitterPass" value="********" disabled><button class="seePass" onclick="seePasswordTwitter()" ><i class="fas fa-eye"></i></button>
                            
                                <button class="btn btn-success" onclick="FB.login()">Login</button>
                                 <button class="btn btn-danger" onclick="fbLogoutUser()">Logout</button>               
                        </div>
                    </div>
                
              </div>
                <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="card" style="width: 18rem;">
                            <img src="../../img/github.png" class="card-img-top image" alt="...">
                        <div class="card-body">
                                <h5 class="card-title">Github</h5>
                               
                                
                                <input class="inputmaster" type="text" name="" id="GithubPass" value="*********" disabled><button class="seePass" onclick="seePasswordGithub()" ><i class="fas fa-eye"></i></button>
                               
                                <button class="btn btn-success" onclick="FB.login()">Login</button>
                                 <button class="btn btn-danger" onclick="githubLogoutUser()">Logout</button>               
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="card" style="width: 18rem;">
                            <img src="../../img/linkedIn.png" class="card-img-top image" alt="...">
                        <div class="card-body">
                                <h5 class="card-title">LinkedIn</h5>
                               
                                <input class="inputmaster" type="text" name="" id="LnPass" value="*********" disabled><button class="seePass" onclick="seePasswordLn()"><i class="fas fa-eye"></i></button>
                            
                                <button class="btn btn-success" onclick="linkedinlogin()">Login</button>
                                 <button class="btn btn-danger" onclick="linkedinlogoutuser()">Logout</button>               
                        </div>
                    </div>
                </div>
                
              
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
<script src="../../js/ejs.js"></script>
<script src="../../js/bCrypt.js"></script>

<script >


var user =  <%- JSON.stringify(user) %>;
console.log(user)
var hashedPassword =null;
var visible = false;
CheckPassword =() => {
  var masterPassword  = document.getElementById("master").value;
  if( !user.passwords){
    var button = document.getElementById("SavePass")
    button.click();

  }
   
   result =(hash) => {
     visible =( hash == user.masterPassword)
    console.log(visible)
    if(!visible) {
      alert("Incorrect Password")
    }
    
  
}
 
  
hashpw(masterPassword,user.salt,result);

}


seePasswordFb = () => {
  
     if(visible)  {
      document.getElementById("fbPass").value = user.passwords.facebook;
      var bytes  = CryptoJS.AES.decrypt(user.passwords.facebook, user.salt);
      var originalText = bytes.toString(CryptoJS.enc.Utf8);
      console.log(originalText)
      document.getElementById("fbPass").value = originalText;
     }
     else {
       var button = document.getElementById("FbPass");
      
       button.click();
      //  document.getElementById("fbPass").value = user.passwords.facebook;
     }
}
seePasswordGithub = () => {
  
  if(visible)  {

    var bytes  = CryptoJS.AES.decrypt(user.passwords.github, user.salt);
      var originalText = bytes.toString(CryptoJS.enc.Utf8);
   document.getElementById("GithubPass").value = originalText;

  }
  else {
    var button = document.getElementById("FbPass");
    
    button.click();
    
  }
}
seePasswordTwitter = () => {
  
  if(visible)  {
    var bytes  = CryptoJS.AES.decrypt(user.passwords.twitter, user.salt);
      var originalText = bytes.toString(CryptoJS.enc.Utf8);
   document.getElementById("TwitterPass").value =originalText;
  }
  else {
    var button = document.getElementById("FbPass");
    
    button.click();
   
  }
}
seePasswordLn = () => {
  
  if(visible)  {
    var bytes  = CryptoJS.AES.decrypt(user.passwords.linkedIn, user.salt);
      var originalText = bytes.toString(CryptoJS.enc.Utf8);
   document.getElementById("LnPass").value = originalText;
  }
  else {
    var button = document.getElementById("FbPass");
    
    button.click();
    
  }
}

</script>

</body>
</html>